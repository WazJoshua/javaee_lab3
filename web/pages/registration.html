<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
            integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
            crossorigin="anonymous"
    />
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"
    ></script>
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"
    ></script>
</head>
<body>
<h1>注册</h1>
<form>
    <label id="usercode-label">Usercode</label>
    <input id="usercode" type="text"><span id="usercodeMSG"></span> <br/>
    <label id="user-name-label">Username</label>
    <input type="text" id="username" name="username"/><br/>
    <label id="password-label">Password</label>
    <input id="password" type="password" name="password"><br/>
    <button id="submitRegister" type="button" class="btn btn-primary">注册</button>
    <div id="altMsg"></div>
</form>
</body>
<script>

    /**
     * 检查用户名是否可用
     */
    $("#usercode").change(
        function () {
            var usercode = $("#usercode").val();
            let c = JSON.stringify({"usercode": usercode});
            $.ajax({
                type: "POST",
                url: "/Lab3Demo/findUsercode",
                contentType: "application/json",
                data: c,
                success: function (success) {
                    $("#usercodeMSG").html(success.msg);
                }
            })
        }
    )

    /**
     * 注册请求
     */
    $("#submitRegister").click(
        function () {
            var usercode = $("#usercode").val();
            var username = $("#username").val();
            var password = $("#password").val();
            if (usercode == "" || username == "" || password == "")
                $("#altMsg").html("请输入用户名,账号,密码");
            let s = JSON.stringify({"usercode": usercode, "username": username, "userpassword": password});
            $.ajax({
                type: "POST",
                url: "/Lab3Demo/registerUser",
                contentType: "application/json",
                data: s,
                success: function (success) {
                    console.log(success);
                    if (success.code == 200)
                        window.location.href = "/Lab3Demo/index.html"
                    else if (success.code == 416) {
                        $("#altMsg").html(success.msg);
                    } else {
                        window.location.href = "/Lab3Demo/error"
                    }
                }
            })
        }
    )

</script>
</html>